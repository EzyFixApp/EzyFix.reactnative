#!/usr/bin/env bash

# EAS Build Post-Install Hook
# Fix Firebase provider conflict in AndroidManifest

set -e

echo "ğŸ”§ Fixing Firebase provider conflict..."
echo "ğŸ“¦ New package: site.ezyfix.app"

MANIFEST_PATH="android/app/src/main/AndroidManifest.xml"

if [ -f "$MANIFEST_PATH" ]; then
  echo "ğŸ“ Found AndroidManifest.xml"
  
  # Add tools namespace if not exists
  if ! grep -q 'xmlns:tools=' "$MANIFEST_PATH"; then
    echo "â• Adding tools namespace"
    sed -i 's/<manifest/<manifest xmlns:tools="http:\/\/schemas.android.com\/tools"/' "$MANIFEST_PATH"
  fi
  
  # Add tools:replace to FirebaseInitProvider
  if grep -q 'FirebaseInitProvider' "$MANIFEST_PATH"; then
    echo "ğŸ”¥ Adding tools:replace to Firebase provider"
    sed -i 's/\(android:name=".*FirebaseInitProvider"\)/\1 tools:replace="android:authorities"/' "$MANIFEST_PATH"
  fi
  
  echo "âœ… Firebase conflict fixed!"
else
  echo "âš ï¸ AndroidManifest.xml not found (will be generated by Expo)"
fi

echo "âœ… Post-install hook completed"
